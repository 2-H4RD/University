---
title: "Untitled"
format: html
editor: visual
---

```{r}
# Загрузка библиотек
library(dplyr)
library(tidyr)
library(ggplot2)
df <- mtcars

# Преобразование данных
str(df)
head(df)

# 2. Преобразование переменных в факторы
df$cyl <- as.factor(df$cyl)
df$gear <- as.factor(df$gear)
df$am <- as.factor(df$am)

# 3. Проверка и обработка пропусков
sum(is.na(df))
df <- na.omit(df)

# 4. Создание новых переменных
df <- df %>%
  mutate(mpg_category = ifelse(mpg > 25, "high", 
                               ifelse(mpg > 15, "medium", "low")))
print(df)
```

```{r}
# Общая сводка по всем переменным
summary(df)

# Статистические параметры для числовых переменных
cat("Среднее значение расхода топлива:", mean(df$mpg), "\n")
cat("Медиана расхода топлива:", median(df$mpg), "\n")
cat("Стандартное отклонение:", sd(df$mpg), "\n")
cat("Дисперсия:", var(df$mpg), "\n")
cat("Минимальное значение:", min(df$mpg), "\n")
cat("Максимальное значение:", max(df$mpg), "\n")

# Анализ по группам
df %>%
  group_by(cyl) %>%
  summarise(
    avg_mpg = mean(mpg),
    median_mpg = median(mpg),
    count = n()
  )

# Анализ категориальных переменных
table(df$am)
prop.table(table(df$am))
```

```{r}
# 1. Гистограмма распределения расхода топлива
hist(df$mpg, 
     main = "Распределение расхода топлива", 
     xlab = "Миль на галлон", 
     col = "lightblue", 
     border = "black")

# 2. Диаграмма "ящик с усами" по типу трансмиссии
boxplot(mpg ~ am, 
        data = df,
        main = "Расход топлива по типу трансмиссии",
        xlab = "Тип трансмиссии (0=автомат, 1=механика)",
        ylab = "Миль на галлон",
        col = c("red", "blue"))

# 3. Диаграмма рассеяния
plot(df$wt, df$mpg,
     main = "Зависимость расхода топлива от веса",
     xlab = "Вес (1000 фунтов)",
     ylab = "Миль на галлон",
     pch = 19,
     col = ifelse(df$am == "0", "red", "blue"))
legend("topright", 
       legend = c("Автомат", "Механика"),
       col = c("red", "blue"), 
       pch = 19)

# 4. Столбчатая диаграмма с использованием ggplot2
ggplot(df, aes(x = cyl, fill = am)) +
  geom_bar(position = "dodge") +
  labs(title = "Количество автомобилей по типу двигателя и трансмиссии",
       x = "Количество цилиндров", 
       y = "Количество автомобилей",
       fill = "Трансмиссия") +
  theme_minimal()

# 5. Матрица корреляций
numeric_vars <- df[, sapply(df, is.numeric)]
cor_matrix <- cor(numeric_vars)
print(cor_matrix)

# Визуализация корреляций
library(corrplot)
corrplot(cor_matrix, method = "circle", type = "upper", 
         tl.col = "black", tl.srt = 45)
```

```{r}
# 1. Проверка гипотез: есть ли разница в расходе топлива между автоматической и механической трансмиссией?
# Нулевая гипотеза H0: средний расход топлива одинаков для обоих типов трансмиссии
# Альтернативная гипотеза H1: средний расход топлива различается

t_test_result <- t.test(mpg ~ am, data = df)
print(t_test_result)

# 2. Анализ дисперсии (ANOVA): влияет ли количество цилиндров на расход топлива?
anova_result <- aov(mpg ~ cyl, data = df)
summary(anova_result)

# 3. Построение линейной модели
model <- lm(mpg ~ wt + hp + cyl, data = df)
summary(model)

# 4. Визуализация результатов линейной модели
par(mfrow = c(2, 2))
plot(model)
par(mfrow = c(1, 1))

# 5. Кластерный анализ
# Стандартизация данных
df_scaled <- scale(df[, c("mpg", "wt", "hp")])
# Кластеризация
set.seed(123)
kmeans_result <- kmeans(df_scaled, centers = 3)
# Визуализация кластеров
plot(df$wt, df$mpg, 
     col = kmeans_result$cluster + 1, 
     pch = 19,
     main = "Кластеры автомобилей",
     xlab = "Вес", 
     ylab = "Расход топлива")
points(kmeans_result$centers[, c("wt", "mpg")], 
       col = 1:3, pch = 8, cex = 2)
```
